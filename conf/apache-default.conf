<VirtualHost _default_:*>

  DocumentRoot ${APP_ROOT}

  Timeout 600

  <Directory ${APP_ROOT}>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    DirectoryIndex index.html index.php
  </Directory>

  ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9001${APP_ROOT}/$1
  SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

  ErrorLog ${APACHE_LOG_DIR}/error.log
  LogLevel warn
  CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost _default_:443>

      DocumentRoot ${APP_ROOT}

      Timeout 600

      SSLEngine on
      SSLCertificateFile /etc/apache2/ssl/apache.crt
      SSLCertificateKeyFile /etc/apache2/ssl/apache.key       
      <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
      </FilesMatch>
      <Directory /usr/lib/cgi-bin>
        SSLOptions +StdEnvVars
      </Directory>
      BrowserMatch "MSIE [2-6]" \
        nokeepalive ssl-unclean-shutdown \
        downgrade-1.0 force-response-1.0
      BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

      <Directory ${APP_ROOT}>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.html index.php
      </Directory>

      ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9001${APP_ROOT}/$1
      SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

      ErrorLog ${APACHE_LOG_DIR}/error.log
      LogLevel warn
      CustomLog ${APACHE_LOG_DIR}/access.log combined
    </VirtualHost>

</IfModule>
